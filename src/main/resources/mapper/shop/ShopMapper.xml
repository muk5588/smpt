<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="shop.dao.ShopDao">

    <!-- 기본 리스트 조회 -->
    <sql id="selectItem">
        SELECT
            itemno, userno, itemname, createdate, price, itemcomm, remain, titleImg
        FROM ITEM
    </sql>
    <select id="getList" parameterType="util.ShopPaging" resultType="dto.Item">
        SELECT * FROM (
            SELECT rownum rnum, I.* FROM (
                <include refid="selectItem"/>
                ORDER BY itemno DESC    
            ) I
        )
        <where>
            AND rnum BETWEEN #{startNo } AND #{endNo }
        </where>
    </select>

 <!-- 가격 범위로 리스트 조회 -->
<select id="getListByPriceRange" parameterType="map" resultType="dto.Item">
    SELECT * FROM (
        SELECT rownum rnum, I.*
        FROM (
            SELECT itemno, userno, itemname, createdate, price, itemcomm, remain, titleImg
            FROM ITEM
            <where>
                <if test="minPrice != null and maxPrice != null">
                    price BETWEEN #{minPrice} AND #{maxPrice}
                </if>
            </where>
            ORDER BY itemno DESC
        ) I
    )
    <!-- 페이징 부분 삭제 -->
</select>

<!-- 총 아이템 수 조회 -->
<select id="selectCntAll" parameterType="util.ShopPaging" resultType="int">
    SELECT COUNT(*)
    FROM ITEM
    <where>
        <!-- 검색어가 존재하는 경우 -->
        <if test="search != null">
            itemname LIKE '%' || #{search} || '%'
        </if>
        <!-- 최소 가격과 최대 가격이 존재하는 경우 -->
        <if test="minPrice != null and maxPrice != null">
            AND price BETWEEN #{minPrice} AND #{maxPrice}
        </if>
    </where>
</select>

    <!-- 아이템 번호로 조회 -->
    <select id="getItemByItemNo" parameterType="int" resultType="dto.Item">
        SELECT itemno, userno, itemname, createdate, price, itemcomm, remain, titleImg
        FROM ITEM
        WHERE itemno = #{itemNo}
    </select>

    <!-- 검색어로 아이템 조회 -->
    <select id="selectBySearch" parameterType="string" resultType="dto.Item">
        SELECT itemno, userno, itemname, createdate, price, itemcomm, remain, titleImg
        FROM ITEM
        WHERE itemname LIKE '%' || #{search} || '%'
        ORDER BY itemno DESC
    </select>
</mapper>
